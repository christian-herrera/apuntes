"use strict";(globalThis.webpackChunkweb_apuntes=globalThis.webpackChunkweb_apuntes||[]).push([[223],{1103:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"php/sqlite","title":"SQLite en PHP","description":"Funciones y t\xe9cnicas para el hashing seguro de contrase\xf1as en PHP.","source":"@site/docs/php/sqlite.mdx","sourceDirName":"php","slug":"/php/sqlite","permalink":"/docs/php/sqlite","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"PHP","permalink":"/docs/tags/php"},{"inline":true,"label":"SQLite","permalink":"/docs/tags/sq-lite"}],"version":"current","lastUpdatedAt":1763178697000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"SQLite en PHP","description":"Funciones y t\xe9cnicas para el hashing seguro de contrase\xf1as en PHP.","tags":["PHP","SQLite"]},"sidebar":"tutorialSidebar","previous":{"title":"Variables","permalink":"/docs/php/variables"},"next":{"title":"WireGuard","permalink":"/docs/ubuntu/wireguard"}}');var s=a(4848),t=a(8453),i=a(1470),l=a(9365);const o={sidebar_position:3,title:"SQLite en PHP",description:"Funciones y t\xe9cnicas para el hashing seguro de contrase\xf1as en PHP.",tags:["PHP","SQLite"]},c="SQLite en PHP",d={},u=[{value:"Crear base de datos",id:"crear-base-de-datos",level:2},{value:"Patr\xf3n Singleton",id:"patr\xf3n-singleton",level:2},{value:"M\xe9todos \xdatiles",id:"m\xe9todos-\xfatiles",level:2}];function p(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:["\n",(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"sqlite-en-php",children:"SQLite en PHP"})}),"\n",(0,s.jsx)(n.p,{children:"SQLite es una base de datos ligera y embebida que no requiere un servidor separado para funcionar. En PHP, se puede utilizar SQLite a trav\xe9s de la extensi\xf3n PDO (PHP Data Objects), que proporciona una interfaz uniforme para acceder a diferentes bases de datos."}),"\n","\n",(0,s.jsx)(n.h2,{id:"crear-base-de-datos",children:"Crear base de datos"}),"\n",(0,s.jsx)(n.p,{children:"SQLite crea automaticamente el archivo cuando la conexi\xf3n se abre."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$db = new PDO('sqlite:' . __DIR__ . '/database.db');\r\n\r\n// Opcional: activar errores como excepciones\r\n$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n\r\n$db->exec(\"\r\n    CREATE TABLE IF NOT EXISTS users (\r\n        id INTEGER PRIMARY KEY,\r\n        username TEXT NOT NULL UNIQUE,\r\n        password TEXT NOT NULL\r\n    )\r\n\");\r\n\r\necho \"Base de datos y tabla 'users' creadas exitosamente.\";\n"})}),"\n",(0,s.jsx)("hr",{style:{marginTop:"40px"}}),"\n","\n",(0,s.jsx)(n.h2,{id:"patr\xf3n-singleton",children:"Patr\xf3n Singleton"}),"\n",(0,s.jsx)(n.p,{children:"El patr\xf3n Singleton permite asegurar que exista una \xfanica instancia de un recurso durante toda la ejecuci\xf3n del programa.\r\nEn el caso de PHP, se utiliza com\xfanmente para mantener una sola conexi\xf3n PDO a la base de datos, evitando crear m\xfaltiples conexiones innecesarias."}),"\n",(0,s.jsx)(n.p,{children:"Para entender su funcionamiento, es importante distinguir entre:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"self"}),": referencia a la clase, no a un objeto. Se usa para acceder a m\xe9todos o propiedades est\xe1ticas."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$this"}),": referencia al objeto instanciado. Solo existe dentro de m\xe9todos no est\xe1ticos."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Como el patr\xf3n Singleton no trabaja con objetos instanciados manualmente (no se usa new), sino con una instancia global controlada por la clase, se utiliza self para acceder a la propiedad que almacenar\xe1 esa \xfanica instancia."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="Database.php"',children:'class Database {\r\n    // Instancia \xfanica (Singleton)\r\n    private static $db = null;\r\n\r\n    // Constructor privado: evita que se pueda hacer "new Database()"\r\n    private function __construct() {}\r\n\r\n    // M\xe9todo est\xe1tico que devuelve siempre la misma conexi\xf3n PDO\r\n    public static function initDB() {\r\n        if (self::$db === null) {\r\n            $pathDB = __DIR__ . "/database.db";\r\n            self::$db = new PDO("sqlite:" . $pathDB);\r\n            self::$db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\r\n        }\r\n        return self::$db;\r\n    }\r\n\r\n    // Ejemplo de m\xe9todo que sua la conexion Singleton\r\n    public function getUser(string $email) {\r\n        $db = self::initDB();\r\n        try {\r\n            $stmt = $db->query("SELECT . . .");\r\n            $stmt->execute([":email" => $email]);\r\n            $user = $stmt->fetch(PDO::FETCH_ASSOC);\r\n            return $user ?: false;\r\n        } catch(PDOException $e) {\r\n            return null;  // Error\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(n.admonition,{title:"Entonces...",type:"note",children:[(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["La primera ves que se llama a ",(0,s.jsx)(n.code,{children:"Database::initDB()"}),", se crea la conexi\xf3n PDO y se almacena en ",(0,s.jsx)(n.code,{children:"self::$db"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["En llamadas posteriores, se devuelve la misma instancia almacenada en ",(0,s.jsx)(n.code,{children:"self::$db"}),", evitando crear nuevas conexiones."]}),"\n",(0,s.jsxs)(n.li,{children:["Durante todo el script, solo existir\xe1 una \xfanica conexi\xf3n a la base de datos gestionada por la clase ",(0,s.jsx)(n.code,{children:"Database"}),"."]}),"\n"]}),(0,s.jsx)(n.p,{children:"La forma de utilizar esto es simplemente:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",metastring:'title="index.php"',children:"require_once __DIR__ . '/Database.php';\r\n$rows = Database::getUser(\"chris@dominio.com\");\n"})})]}),"\n",(0,s.jsx)("hr",{style:{marginTop:"40px"}}),"\n","\n",(0,s.jsx)(n.h2,{id:"m\xe9todos-\xfatiles",children:"M\xe9todos \xdatiles"}),"\n",(0,s.jsx)(n.p,{children:"Se listan a continuaci\xf3n algunos m\xe9todos \xfatiles para trabajar con SQLite en PHP utilizando PDO."}),"\n",(0,s.jsxs)(i.A,{children:[(0,s.jsxs)(l.A,{value:"config",label:"Configuraciones",default:!0,children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"setAttribute()"})," permite configurar par\xe1metros de la conexi\xf3n PDO."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"// Configura:\r\n// - PDO puede lanzar excepciones en caso de error\r\n// - Devuelve arrays asociativos por defecto, (['columna' => valor, ...])\r\n$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION)\n"})})]}),(0,s.jsxs)(l.A,{value:"exec",label:"Ejecuciones",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"prepare()"})," simplemente prepara una sentencia SQL para su ejecuci\xf3n posterior. Luego ",(0,s.jsx)(n.code,{children:"execute()"})," ejecuta la sentencia preparada completando los par\xe1metros si es necesario."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$stmt = $pdo->prepare(\"INSERT INTO users (username, password) VALUES (:username, :password)\");\r\n$stmt->execute([\r\n    ':username' => 'usuario1',\r\n    ':password' => password_hash('mi_contrase\xf1a', PASSWORD_DEFAULT)\r\n]);\n"})}),(0,s.jsxs)(n.p,{children:["Otra opci\xf3n es usar ",(0,s.jsx)(n.code,{children:"query()"}),"para ejecutar una sentencia SQL directamente sin par\xe1metros."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$stmt = $pdo->query("SELECT * FROM users");\n'})})]}),(0,s.jsxs)(l.A,{value:"fetch",label:"Obtenci\xf3n de datos",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"fetch()"})," obtiene solo ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"una fila"})})," de la consulta ejecutada. Si no hay m\xe1s filas, devuelve ",(0,s.jsx)(n.code,{children:"false"}),"."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$user = $stmt->fetch(PDO::FETCH_ASSOC);  // ['id' => 1, 'email' => 'test@test.com'])\r\n$user = $stmt->fetch(PDO::FETCH_OBJ);    // $user->id, $user->email\n"})}),(0,s.jsxs)(n.p,{children:["Para obtener ",(0,s.jsx)(n.em,{children:(0,s.jsx)(n.strong,{children:"todas las filas"})})," de una consulta, se usa ",(0,s.jsx)(n.code,{children:"fetchAll()"})," el cual devuelve un array que dentro contiene un array por cada fila obtenida. Si no encuentra ninguna fila, entonces devuelve un array vac\xedo ",(0,s.jsx)(n.code,{children:"[]"}),"."]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$users = $stmt->fetchAll(PDO::FETCH_ASSOC);  // [ ['id' => 1, 'email' => 'test@test.com'], ... ]\r\n$users = $stmt->fetchAll(PDO::FETCH_OBJ);    // [ $user1, $user2, ... ]\n"})}),(0,s.jsx)(n.p,{children:"Pero puede consumir mucha memoria si la tabla es grande."})]}),(0,s.jsxs)(l.A,{value:"count",label:"Contar Resultados",children:[(0,s.jsxs)(n.p,{children:["Solo para las consultas ",(0,s.jsx)(n.code,{children:"INSERT"}),", ",(0,s.jsx)(n.code,{children:"UPDATE"})," o ",(0,s.jsx)(n.code,{children:"DELETE"}),", se puede hacer uso de ",(0,s.jsx)(n.code,{children:"rowCount()"})," para obtener el n\xfamero de filas ",(0,s.jsx)(n.em,{children:"afectadas"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"return $stmt->rowCount() > 0;  // True si se afect\xf3 al menos una fila\n"})}),(0,s.jsxs)(n.p,{children:["Cuando se realiza un ",(0,s.jsx)(n.code,{children:"INSERT"}),", se puede obtener el ID de la \xfaltima fila insertada con ",(0,s.jsx)(n.code,{children:"lastInsertId()"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$lastId = $pdo->lastInsertId();\n"})})]})]}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(n.p,{children:"Entonces, con estas funciones se pueden crear algunos m\xe9todos b\xe1sicos para cada operacion:"}),"\n",(0,s.jsxs)(i.A,{children:[(0,s.jsxs)(l.A,{value:"select",label:"SELECT",default:!0,children:[(0,s.jsx)(n.p,{children:"Utilizando par\xe1metros:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$db = Database::initDB();\r\n$stmt = $db->prepare("SELECT * FROM users WHERE email = :email");\r\n$stmt->execute([":email" => $email]);\r\n$user = $stmt->fetch(PDO::FETCH_ASSOC); // ["id" => 1, "email" => "test@test.com"]\r\n                                        // `false` si no existe\r\n\r\nif(!$user) { /* No encontrado */}\n'})}),(0,s.jsx)(n.p,{children:"Y si no hay par\xe1metrso se simplifica:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$db = Database::initDB();\r\n$stmt = $db->query("SELECT id, email FROM users");\r\n$users = $stmt->fetchAll(PDO::FETCH_ASSOC); // -> [ ["id" => 1, "email" => "test@test.com"], ... ]\r\n                                            // -> [] si no hay usuarios\r\nif(empty($users)) { /* No hay usuarios */ }\n'})})]}),(0,s.jsxs)(l.A,{value:"insert",label:"INSERT",default:!0,children:[(0,s.jsxs)(n.p,{children:["La forma de hacer un ",(0,s.jsx)(n.em,{children:"insert"})," seguro es con:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$db = Database::initDB();\r\ntry {\r\n    $stmt = $db->prepare("INSERT INTO users (email, password) VALUES (:email, :password)");\r\n    $stmt->execute([\r\n        ":email" => $email,\r\n        ":password" => password_hash($password, PASSWORD_DEFAULT)\r\n    ]);\r\n    return $db->lastInsertId();  // -> Devuelve el ID del nuevo usuario\r\n} catch(PDOException $e) {\r\n    return null;  // -> Error (ej: email ya existe)\r\n}\n'})})]}),(0,s.jsxs)(l.A,{value:"update",label:"UPDATE",default:!0,children:[(0,s.jsxs)(n.p,{children:["Los ",(0,s.jsx)(n.em,{children:"updates"})," se realizan de forma similar:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'$db = Database::initDB();\r\ntry {\r\n    $stmt = $db->prepare("UPDATE users SET password = :password WHERE email = :email");\r\n    $stmt->execute([\r\n        ":password" => password_hash($newPassword, PASSWORD_DEFAULT),\r\n        ":email" => $email\r\n    ]);\r\n    return $stmt->rowCount() > 0;  // -> True si se actualiz\xf3 al menos un usuario\r\n} catch(PDOException $e) {\r\n    return null;  // -> Error\r\n}\n'})})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},1470:(e,n,a)=>{a.d(n,{A:()=>D});var r=a(6540),s=a(4164),t=a(7559),i=a(3104),l=a(6347),o=a(205),c=a(7485),d=a(1682),u=a(679);function p(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,r.useMemo)(()=>{const e=n??function(e){return p(e).map(({props:{value:e,label:n,attributes:a,default:r}})=>({value:e,label:n,attributes:a,default:r}))}(a);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,a])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function x({queryString:e=!1,groupId:n}){const a=(0,l.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(s),(0,r.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})},[s,a])]}function b(e){const{defaultValue:n,queryString:a=!1,groupId:s}=e,t=h(e),[i,l]=(0,r.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=n.find(e=>e.default)??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:t})),[c,d]=x({queryString:a,groupId:s}),[p,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[a,s]=(0,u.Dv)(n);return[a,(0,r.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),f=(()=>{const e=c??p;return m({value:e,tabValues:t})?e:null})();(0,o.A)(()=>{f&&l(f)},[f]);return{selectedValue:i,selectValue:(0,r.useCallback)(e=>{if(!m({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)},[d,b,t]),tabValues:t}}var f=a(2303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=a(4848);function E({className:e,block:n,selectedValue:a,selectValue:r,tabValues:t}){const l=[],{blockElementScrollPositionUntilNextRender:o}=(0,i.a_)(),c=e=>{const n=e.currentTarget,s=l.indexOf(n),i=t[s].value;i!==a&&(o(n),r(i))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const a=l.indexOf(e.currentTarget)+1;n=l[a]??l[0];break}case"ArrowLeft":{const a=l.indexOf(e.currentTarget)-1;n=l[a]??l[l.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:t.map(({value:e,label:n,attributes:r})=>(0,g.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...r,className:(0,s.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":a===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:a}){const t=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=t.find(e=>e.props.value===a);return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:t.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function $(e){const n=b(e);return(0,g.jsxs)("div",{className:(0,s.A)(t.G.tabs.container,"tabs-container",j.tabList),children:[(0,g.jsx)(E,{...n,...e}),(0,g.jsx)(v,{...n,...e})]})}function D(e){const n=(0,f.A)();return(0,g.jsx)($,{...e,children:p(e.children)},String(n))}},8453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>l});var r=a(6540);const s={},t=r.createContext(s);function i(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(t.Provider,{value:n},e.children)}},9365:(e,n,a)=>{a.d(n,{A:()=>i});a(6540);var r=a(4164);const s={tabItem:"tabItem_Ymn6"};var t=a(4848);function i({children:e,hidden:n,className:a}){return(0,t.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,a),hidden:n,children:e})}}}]);